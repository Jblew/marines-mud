<script type="text/javascript">
	Ext.require(['*']);

	Ext.onReady(function() {
		Ext.regModel('MudUser', {
			fields: [
				{name: 'login', type: 'string'},
				{name: 'logged', type: 'boolean'},
				{name: 'strlogged', type: 'string'},
				{name: 'level', type: 'int'},
				{name: 'room', type: 'string'},
				{name: 'strhp', type: 'string'}
			],
			idProperty: 'Login'
		});

		var usersStore = new Ext.data.Store({
			autoLoad: true,
			model: 'MudUser',
			groupField: 'strlogged',
			sorters: ['Login'],
			proxy: {
				type: 'ajax',
				url : '/editor?page=usersgrid&noHeader=true',
				reader: {
					type: 'json',
					root: 'users'
				}
			}
		});

		Ext.regModel('MudMob', {
			fields: [
				{name: 'id', type: 'int'},
				{name: 'name', type: 'string'},
				{name: 'race', type: 'string'},
				{name: 'room', type: 'string'}
			],
			idProperty: 'id'
		});

		var mobsStore = new Ext.data.Store({
			autoLoad: true,
			model: 'MudMob',
			sorters: ['id'],
			proxy: {
				type: 'ajax',
				url : '/editor?page=mobsgrid&noHeader=true',
				reader: {
					type: 'json',
					root: 'mobs'
				}
			}
		});

		Ext.regModel('MudObject', {
			fields: [
				{name: 'vnum', type: 'int'},
				{name: 'name', type: 'string'},
				{name: 'type', type: 'string'}
			],
			idProperty: 'vnum'
		});

		var objectsStore = new Ext.data.Store({
			autoLoad: true,
			model: 'MudMob',
			sorters: ['vnum'],
			proxy: {
				type: 'ajax',
				url : '/editor?page=objectsgrid&noHeader=true',
				reader: {
					type: 'json',
					root: 'objects'
				}
			}
		});

		/*Ext.regModel('Prog', {
			fields: [
				{name: 'name', type: 'string'},
				{name: 'code', type: 'string'},
			],
			idProperty: 'name'
		});

		var progsStore = new Ext.data.Store({
			autoLoad: true,
			model: 'Prog',
			groupField: 'strlogged',
			sorters: ['name'],
			proxy: {
				type: 'ajax',
				url : '/editor?page=progsgrid&noHeader=true',
				reader: {
					type: 'json',
					root: 'progs'
				}
			}
		});*/

		Ext.regModel('MudArea', {
			fields: [
				{name: 'id', type: 'int'},
				{name: 'name', type: 'string'},
				{name: 'type', type: 'string'},
				{name: 'min_room', type: 'int'},
				{name: 'max_room', type: 'int'},
				{name: 'reset_ticks', type: 'int'}
			],
			idProperty: 'id'
		});

		var areasStore = new Ext.data.Store({
			autoLoad: true,
			model: 'MudArea',
			sorters: ['id'],
			proxy: {
				type: 'ajax',
				url : '/editor?page=areasgrid&noHeader=true',
				reader: {
					type: 'json',
					root: 'areas'
				}
			}
		});

		Ext.regModel('MudAreaType', {
			fields: [
				{name: 'name', type: 'string'}
			],
			idProperty: 'name'
		});

		Ext.regModel('MudExitType', {
			fields: [
				{name: 'name', type: 'string'}
			],
			idProperty: 'name'
		});

		Ext.regModel('MudRoom', {
			fields: [
				{name: 'vnum', type: 'int'},
				{name: 'name', type: 'string'},
				{name: 'text', type: 'string'},
				{name: 'sign', type: 'string'},
				{name: 'areaType', type: 'string'},
				{name: 'areaId', type: 'int'},
				{name: 'north_exit_vnum', type: 'int'},
				{name: 'south_exit_vnum', type: 'int'},
				{name: 'west_exit_vnum', type: 'int'},
				{name: 'east_exit_vnum', type: 'int'},
				{name: 'up_exit_vnum', type: 'int'},
				{name: 'down_exit_vnum', type: 'int'},

				{name: 'north_exit_name', type: 'string'},
				{name: 'south_exit_name', type: 'string'},
				{name: 'west_exit_name', type: 'string'},
				{name: 'east_exit_name', type: 'string'},
				{name: 'up_exit_name', type: 'string'},
				{name: 'down_exit_name', type: 'string'},

				{name: 'north_exit_type', type: 'string'},
				{name: 'south_exit_type', type: 'string'},
				{name: 'west_exit_type', type: 'string'},
				{name: 'east_exit_type', type: 'string'},
				{name: 'up_exit_type', type: 'string'},
				{name: 'down_exit_type', type: 'string'},
			],
			idProperty: 'vnum'
		});

		var roomsStore = new Ext.data.Store({
			autoLoad: true,
			model: 'MudRoom',
			sorters: ['vnum'],
			proxy: {
				type: 'ajax',
				url : '/editor?page=roomsgrid&noHeader=true',
				reader: {
					type: 'json',
					root: 'rooms'
				}
			}
		});

		Ext.create('Ext.Viewport', {
			layout: {
				type: 'border',
				padding: 5
			},
			defaults: {
				split: true
			},
			items: [{
					region: 'center',
					title: 'Edytor Krain Marines',
					layout: 'border',
					border: false,
					items: [{
							region: 'center',
							items: [
								Ext.create('Ext.TabPanel', {
									plain:true,
									height: '100%',
									defaults:{autoScroll: true},
									items:[{
											title: 'Podsumowanie',
											autoLoad:'/editor?page=overview&noHeader=true'
										},
										Ext.create('Ext.grid.GridPanel', {
											id: 'usersGridView',
											title: 'Użytkownicy',
											store: usersStore,
											items: [{
													features: [{
															ftype: 'grouping'
														}],
													headers: [{
															text: 'Login',
															flex: 1,
															dataIndex: 'login'
														},{
															text: 'Zalogowany',
															flex: 1,
															dataIndex: 'strlogged',
															align: 'center',
															renderer: function(value, metaData, record, rowIndex, colIndex, store) {
																if (record.data.logged)
																	return '<img src="http://jblew.pl/forMud/icons/true.png" />';
																else
																	return '<img src="http://jblew.pl/forMud/icons/false.png" />';
															}
														},{
															text: 'Poziom',
															flex: 1,
															dataIndex: 'level'
														},{
															text: 'Pokój',
															flex: 1,
															dataIndex: 'room'
														},{
															text: 'Hp',
															flex: 1,
															dataIndex: 'strhp'
														}]
												}]
										}),
										/*Ext.create('Ext.grid.GridPanel', {
											id: 'progsGridView',
											title: 'Programy',
											store: progsStore,
											items: [{
													headers: [{
															text: 'Nazwa',
															flex: 1,
															dataIndex: 'name'
														},{
															header: 'Opcje',
															flex: 1,
															dataIndex: 'id',
															renderer: function(value, metaData, record, rowIndex, colIndex, store) {
																return '<a href="javascript: editProg(\''+record.data.name+'\', \''+record.data.code+'\', '+rowIndex+');">Edytuj</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript: deleteProg('+record.data.name+', '+rowIndex+');">Usuń</a>';
															}
														}]
												}],
											dockedItems: [{
													xtype: 'toolbar',
													dock: 'bottom',
													items: [{
															itemId: 'progsAddNewButton',
															text: 'Dodaj nowy program',
															handler: function() {
																editProg('Nazwa', 'MudLogger.log("Ja działam!");');
															}
														}]
												}]
										}),*/
										Ext.create('Ext.grid.GridPanel', {
											id: 'areasGridView',
											title: 'Krainy',
											store: areasStore,
											items: [{
													headers: [{
															text: 'Id',
															flex: 1,
															dataIndex: 'id'
														},{
															text: 'Nazwa',
															flex: 1,
															dataIndex: 'name'
														},{
															text: 'Typ',
															flex: 1,
															dataIndex: 'type'
														},{
															text: 'min_room',
															flex: 1,
															dataIndex: 'min_room'
														},{
															text: 'max_room',
															flex: 1,
															dataIndex: 'max_room'
														},{
															text: 'reset_ticks',
															flex: 1,
															dataIndex: 'reset_ticks'
														},{
															header: 'Opcje',
															flex: 1,
															dataIndex: 'id',
															renderer: function(value, metaData, record, rowIndex, colIndex, store) {
																return '<a href="javascript: editArea('+record.data.id+', \''+record.data.name+'\', \''+record.data.type+'\', '+record.data.min_room+', '+record.data.max_room+', '+record.data.reset_ticks+', '+rowIndex+');">Edytuj</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript: deleteArea('+record.data.id+', '+rowIndex+');">Usuń</a>';
															}
														}]
												}],
											dockedItems: [{
													xtype: 'toolbar',
													dock: 'bottom',
													items: [{
															itemId: 'areasGridAddNewButton',
															text: 'Dodal nową krainę',
															handler: function() {
																editArea('-1', 'Nazwa krainy', 'Typ krainy', 'MinRoom', 'MaxRoom', 'ResetTicks', '0');
															}
														}]
												}]
										}),
										Ext.create('Ext.grid.GridPanel', {
											id: 'roomsGridView',
											title: 'Roomy',
											store: roomsStore,
											items: [{
													headers: [{
															text: 'vnum',
															flex: 1,
															dataIndex: 'vnum'
														},{
															text: 'Nazwa',
															flex: 1,
															dataIndex: 'name'
														},{
															text: 'Tekst',
															flex: 1,
															dataIndex: 'text'
														},{
															text: 'Znak',
															flex: 1,
															dataIndex: 'sign'
														},{
															text: '#Kraina',
															flex: 1,
															dataIndex: 'areaId'
														},{
															text: 'Typ krainy',
															flex: 1,
															dataIndex: 'areaType'
														},{
															text: 'Pólnoc',
															flex: 1,
															dataIndex: 'north_exit_vnum',
															renderer: function(value, metaData, record, rowIndex, colIndex, store) {
																if(value == -1) return ' ';
																else return value+' ('+record.data.north_exit_name+')';
															}
														},{
															text: 'Południe',
															flex: 1,
															dataIndex: 'south_exit_vnum',
															renderer: function(value, metaData, record, rowIndex, colIndex, store) {
																if(value == -1) return ' ';
																else return value+' ('+record.data.south_exit_name+')';
															}
														},{
															text: 'Wschód',
															flex: 1,
															dataIndex: 'east_exit_vnum',
															renderer: function(value, metaData, record, rowIndex, colIndex, store) {
																if(value == -1) return ' ';
																else return value+' ('+record.data.east_exit_name+')';
															}
														},{
															text: 'Zachód',
															flex: 1,
															dataIndex: 'west_exit_vnum',
															renderer: function(value, metaData, record, rowIndex, colIndex, store) {
																if(value == -1) return ' ';
																else return value+' ('+record.data.west_exit_name+')';
															}
														},{
															text: 'Góra',
															flex: 1,
															dataIndex: 'up_exit_vnum',
															renderer: function(value, metaData, record, rowIndex, colIndex, store) {
																if(value == -1) return ' ';
																else return value+' ('+record.data.up_exit_name+')';
															}
														},{
															text: 'Dół',
															flex: 1,
															dataIndex: 'down_exit_vnum',
															renderer: function(value, metaData, record, rowIndex, colIndex, store) {
																if(value == -1) return ' ';
																else return value+' ('+record.data.down_exit_name+')';
															}
														},{
															header: 'Opcje',
															flex: 1,
															dataIndex: 'vnum',
															renderer: function(value, metaData, record, rowIndex, colIndex, store) {
																return '<a href="javascript: editRoom(false, '+record.data.vnum+', \''+record.data.name+'\', \''+record.data.text+'\', \''+record.data.sign+'\', '+record.data.areaId+', \''+record.data.areaType+'\', '+record.data.north_exit_vnum+', \''+record.data.north_exit_name+'\', \''+record.data.north_exit_type+'\', '+record.data.south_exit_vnum+', \''+record.data.south_exit_name+'\', \''+record.data.south_exit_type+'\', '+record.data.west_exit_vnum+', \''+record.data.west_exit_name+'\', \''+record.data.west_exit_type+'\', '+record.data.east_exit_vnum+', \''+record.data.east_exit_name+'\', \''+record.data.east_exit_type+'\', '+record.data.up_exit_vnum+', \''+record.data.up_exit_name+'\', \''+record.data.up_exit_type+'\', '+record.data.down_exit_vnum+', \''+record.data.down_exit_name+'\', \''+record.data.down_exit_type+'\', '+rowIndex+');">Edytuj</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript: deleteRoom('+record.data.vnum+', '+rowIndex+');">Usuń</a>';
															}
														}]
												}],
											dockedItems: [{
													xtype: 'toolbar',
													dock: 'bottom',
													items: [{
															itemId: 'roomsGridAddNewButton',
															text: 'Dodaj nowy room',
															handler: function() {
																editRoom(true, 0, 'nazwa', 'tekst', '+', 0, 'las', -1, 'n', 'przejscie', -1, 's', 'przejscie', -1, 'w', 'przejscie', -1, 'e', 'przejscie', -1, 'u', 'przejscie', -1, 'd', 'przejscie', 0);
															}
														}]
												}]
										}),
										Ext.create('Ext.grid.GridPanel', {
											id: 'mobsGridView',
											title: 'Moby',
											store: mobsStore,
											items: [{
													headers: [{
															text: 'Id',
															flex: 1,
															dataIndex: 'id'
														},{
															text: 'Nazwa',
															flex: 1,
															dataIndex: 'name'
														},{
															text: 'Pokój',
															flex: 1,
															dataIndex: 'room'
														},{
															text: 'Rasa',
															flex: 1,
															dataIndex: 'race'
														},{
															header: 'Opcje',
															flex: 1,
															dataIndex: 'id',
															renderer: function(value, metaData, record, rowIndex, colIndex, store) {
																return '<a href="javascript: editMob('+record.data.id+', '+rowIndex+');">Edytuj</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript: deleteMob('+record.data.id+', '+rowIndex+');">Usuń</a>';
															}
														}]
												}]
										}),
										{
											title: 'Wyloguj się',
											listeners: {activate:function() {
													document.location.href="/editor?logout=true"
												}},
											html: '<a href="/editor?logout = true">Wyloguj się</a>'
										}
									]
								})
							]
						}]
				}]
		});
		reloadUsersGrid();
	});




	function editMob(id, rowIndex) {
		//a/lert("Edytujesz okno (id="+id+"; name="+name+"; type="+type+"; min_room="+min_room+"; max_room="+max_room+"; reset_ticks="+reset_ticks+")");
		var emId = Ext.id();
		Ext.create('widget.window', {
			id: 'mobEditWindow'+emId,
			title: 'Edytuj moba #'+id,
			closable: true,
			width: 600,
			height: 350,
			autoScroll:true,
			html: '<iframe src="/editor?page=mobeditor&id='+id+'" width="100%" height="300"><p>Niestety twoja przeglądarka nie obsługuje ramek iframes.</p></iframe>'
		});

		Ext.getCmp("mobEditWindow"+emId).show(this);
	}

	function deleteMob(id, rowIndex) {
		Ext.MessageBox.confirm('Confirm', 'Czy na pewno chcesz usunąć tego moba ('+id+')', function(btn) {
			if(btn == 'yes') {
				Ext.Ajax.request({
					url : '/editor?page=deletemob&noHeader=true&mobid='+id ,
					method: 'GET',
					success: function ( result, request ) {
						if(result.responseText.indexOf("OKOK") >= 0) Ext.getCmp("mobsGridView").store.load();
						else Ext.MessageBox.alert('Failed', "Nie udało się usunąć tego moba: "+result.responseText+"!");
					},
					failure: function ( result, request) {
						Ext.MessageBox.alert('Failed', "Nie udało się usunąć tego moba!");
					}
				});
			}
		});
	}





	function editArea(id, name, type, min_room, max_room, reset_ticks, rowIndex) {
		//a/lert("Edytujesz okno (id="+id+"; name="+name+"; type="+type+"; min_room="+min_room+"; max_room="+max_room+"; reset_ticks="+reset_ticks+")");
		var eaId = Ext.id();
		Ext.create('Ext.form.FormPanel', {
			id: 'areaEditForm'+eaId,
			url:'/editor?page=saveArea&noHeader=true',
			bodyStyle:'padding:5px',
			fieldDefaults: {
				msgTarget: 'side',
				labelWidth: 75
			},
			defaultType: 'textfield',
			defaults: {
				anchor: '100%'
			},

			items: [{
					fieldLabel: 'Id',
					name: 'id',
					allowBlank:false,
					value: id,
					xtype: 'displayfield'
				},{
					fieldLabel: 'Nazwa',
					name: 'name',
					allowBlank:false,
					value: name
				},/*{
					fieldLabel: 'Typ',
					name: 'type',
					allowBlank:false,
					value: type
				}*/{
					xtype: 'combobox',
					fieldLabel: 'Typ',
					name: 'type',
					store: new Ext.data.Store({
						model: 'MudAreaType',
						id: 'AreaTypesStore',
						data : [
								<%
								var first = true;
							var areaTypes = AreaTypes.getAreaTypesNames();
							for(var i in areaTypes) {
								if(!first) {
									web.out.print(",");
								}
								first = false;
								web.out.println("{name: '"+areaTypes[i]+"'}");
							}
								%>
							]
					}),
					valueField: 'name',
					displayField: 'name',
					queryMode: 'local',
					emptyText: 'Wybierz domyślny typ krain...',
					allowBlank:false,
					value: type
				},{
					fieldLabel: 'MinRoom',
					name: 'min_room',
					allowBlank:false,
					value: min_room,
					xtype: 'numberfield',
					minValue: 0
				},{
					fieldLabel: 'MaxRoom',
					name: 'max_room',
					allowBlank:false,
					value: max_room,
					xtype: 'numberfield',
					minValue: 0
				},{
					fieldLabel: 'ResetTicks	',
					name: 'reset_ticks',
					allowBlank:false,
					value: reset_ticks,
					xtype: 'numberfield',
					minValue: 0
				}],

			buttons: [{
					text: 'Zapisz',
					handler: function() {
						Ext.Ajax.request({
							url : '/editor?page=savearea&noHeader=true&id='+id+'&name='+Ext.getCmp('areaEditForm'+eaId).getForm().findField('name').value+'&type='+Ext.getCmp('areaEditForm'+eaId).getForm().findField('type').value+'&min_room='+Ext.getCmp('areaEditForm'+eaId).getForm().findField('min_room').value+'&max_room='+Ext.getCmp('areaEditForm'+eaId).getForm().findField('max_room').value+'&reset_ticks='+Ext.getCmp('areaEditForm'+eaId).getForm().findField('reset_ticks').value ,
							method: 'GET',
							success: function ( result, request ) {
								if(result.responseText.indexOf("OKOK") >= 0) {
									Ext.getCmp("areasGridView").store.load();
									Ext.getCmp("areaEditWindow"+eaId).hide();
								}
								else Ext.MessageBox.alert('Failed', "Błąd: "+result.responseText+"!");
							},
							failure: function ( result, request) {
								Ext.MessageBox.alert('Failed', "Nie udało się zapisać tej krainy!");
							}
						});
					}
				},{
					text: 'Anuluj',
					handler: function() {
						Ext.getCmp("areaEditWindow"+eaId).hide();
					}
				}]
		});


		Ext.create('widget.window', {
			id: 'areaEditWindow'+eaId,
			title: 'Edytuj krainę: '+name+' #'+id,
			bodyStyle:'padding:5px',
			closable: true,
			width: 600,
			height: 350,
			plain: true,
			layout: 'fit',
			items: [Ext.getCmp('areaEditForm'+eaId)]
		});

		Ext.getCmp("areaEditWindow"+eaId).show(this);
	}

	function deleteArea(id, rowIndex) {
		Ext.MessageBox.confirm('Confirm', 'Czy na pewno chcesz usunąć tą krainę', function(btn) {
			if(btn == 'yes') {
				Ext.Ajax.request({
					url : '/editor?page=deletearea&noHeader=true&areaId='+id ,
					method: 'GET',
					success: function ( result, request ) {
						if(result.responseText.indexOf("OKOK") >= 0) Ext.getCmp("areasGridView").store.load();
						else Ext.MessageBox.alert('Failed', "Nie udało się usunąć tej krainy: "+result.responseText+"!");
					},
					failure: function ( result, request) {
						Ext.MessageBox.alert('Failed', "Nie udało się usunąć tej krainy!");
					}
				});
			}
		});
	}







	function editProg(name, code, rowIndex) {
		//a/lert("Edytujesz program (name="+name+"; code="+Base64.decode(code)+")");
		var epId = Ext.id();
		Ext.create('Ext.form.FormPanel', {
			id: 'progEditForm'+epId,
			url:'/editor?page=saveprog&noHeader=true',
			bodyStyle:'padding:5px',
			fieldDefaults: {
				msgTarget: 'side',
				labelWidth: 80
			},
			defaultType: 'textfield',
			defaults: {
				anchor: '100%'
			},

			items: [{
					fieldLabel: 'Nazwa',
					name: 'name',
					allowBlank:false,
					value: name
				},{
					fieldLabel: 'Kod',
					name: 'code',
					allowBlank:false,
					xtype: 'textareafield',
					value: code
				}],

			buttons: [{
					text: 'Zapisz',
					handler: function() {
						Ext.Ajax.request({
							url : '/editor?page=saveprog&noHeader=true&oldname='+name+'&name='+Ext.getCmp('progEditForm'+epId).getForm().findField('name').value+'&code='+Ext.getCmp('progEditForm'+epId).getForm().findField('code').value,
							method: 'GET',
							success: function ( result, request ) {
								if(result.responseText.indexOf("OKOK") >= 0) {
									Ext.getCmp("progsGridView").store.load();
									Ext.getCmp("progEditWindow"+epId).hide();
								}
								else Ext.MessageBox.alert('Failed', "Błąd: "+result.responseText+"!");
							},
							failure: function ( result, request) {
								Ext.MessageBox.alert('Failed', "Nie udało się zapisać tej krainy!");
							}
						});
					}
				},{
					text: 'Anuluj',
					handler: function() {
						Ext.getCmp("progEditWindow"+epId).hide();
					}
				}]
		});


		Ext.create('widget.window', {
			id: 'progEditWindow'+epId,
			title: 'Edytuj program: '+name,
			bodyStyle:'padding:5px',
			closable: true,
			width: 600,
			height: 350,
			plain: true,
			layout: 'fit',
			items: [Ext.getCmp('progEditForm'+epId)]
		});

		Ext.getCmp("progEditWindow"+epId).show(this);
	}

	function deleteProg(name, rowIndex) {
		Ext.MessageBox.confirm('Confirm', 'Czy na pewno chcesz usunąć program '+name, function(btn) {
			if(btn == 'yes') {
				Ext.Ajax.request({
					url : '/editor?page=deleteprog&noHeader=true&name='+name ,
					method: 'GET',
					success: function ( result, request ) {
						if(result.responseText.indexOf("OKOK") >= 0) Ext.getCmp("areasGridView").store.load();
						else Ext.MessageBox.alert('Failed', "Nie udało się usunąć tego programu: "+result.responseText+"!");
					},
					failure: function ( result, request) {
						Ext.MessageBox.alert('Failed', "Nie udało się usunąć tego programu!");
					}
				});
			}
		});
	}








	function editRoom(newroom, vnum, name, text, sign, areaId, areaType, n_vnum, n_name, n_type, s_vnum, s_name, s_type, w_vnum, w_name, w_type, e_vnum, e_name, e_type, u_vnum, u_name, u_type, d_vnum, d_name, d_type, rowIndex) {
		//if(newroom) a/lert('NOWY ROOM');
		var erId = Ext.id();
		Ext.create('Ext.form.FormPanel', {
			id: 'roomEditForm'+erId,
			url:'/editor?page=saveRoom&noHeader=true',
			bodyStyle:'padding:5px',
			fieldDefaults: {
				msgTarget: 'side',
				labelWidth: 120
			},
			defaultType: 'textfield',
			defaults: {
				anchor: '100%'
			},
			autoScroll:true,
			
			items: [{
					fieldLabel: 'Vnum',
					name: 'vnum',
					allowBlank:false,
					value: vnum,
					xtype: 'numberfield'
				},{
					fieldLabel: 'Nazwa',
					name: 'name',
					allowBlank:false,
					value: name
				},{
					fieldLabel: 'Tekst',
					name: 'text',
					allowBlank:false,
					xtype: 'textareafield',
					value: text
				},{
					xtype: 'numberfield',
					fieldLabel: 'Kraina',
					name: 'areaId',
					allowBlank:false,
					value: areaId
				},{
					fieldLabel: 'Znak na mapie',
					name: 'sign',
					allowBlank:false,
					value: sign
				},{
					xtype: 'combobox',
					fieldLabel: 'Typ',
					name: 'areaType',
					store: new Ext.data.Store({
						model: 'MudAreaType',
						data : [
								<%
								var first = true;
							var areaTypes = AreaTypes.getAreaTypesNames();
							for(var i in areaTypes) {
								if(!first) {
									web.out.print(",");
								}
								first = false;
								web.out.println("{name: '"+areaTypes[i]+"'}");
							}
								%>
							]
					}),
					valueField: 'name',
					displayField: 'name',
					queryMode: 'local',
					emptyText: 'Pozostaw puste, aby użyć domyślnego',
					allowBlank: true,
					value: areaType
				},{
					fieldLabel: ' ',
					name: 'n_e_p',
					allowBlank:false,
					value: ' ',
					xtype: 'displayfield'
				},{
					fieldLabel: 'Północne wyjście',
					name: 'n_e',
					allowBlank:false,
					value: ' ',
					xtype: 'displayfield'
				},{
					fieldLabel: '    VNUM',
					name: 'n_vnum',
					allowBlank:false,
					value: n_vnum,
					xtype: 'numberfield'
				},{
					fieldLabel: '    NAZWA',
					name: 'n_name',
					allowBlank:false,
					value: n_name
				},{
					xtype: 'combobox',
					fieldLabel: '    TYP',
					name: 'n_type',
					store: new Ext.data.Store({
						model: 'MudExitType',
						data : [
								<%
								var first = true;
							var exitTypes = ExitTypes.getExitTypesNames();
							for(var i in exitTypes) {
								if(!first) {
									web.out.print(",");
								}
								first = false;
								web.out.println("{name: '"+exitTypes[i]+"'}");
							}
								%>
							]
					}),
					valueField: 'name',
					displayField: 'name',
					queryMode: 'local',
					emptyText: 'Wybierz typ wyjścia',
					allowBlank: false,
					value: n_type
				},{
					fieldLabel: ' ',
					name: 's_e_p',
					allowBlank:false,
					value: ' ',
					xtype: 'displayfield'
				},{
					fieldLabel: 'Południowe wyjście',
					name: 's_e',
					allowBlank:false,
					value: ' ',
					xtype: 'displayfield'
				},{
					fieldLabel: '    VNUM',
					name: 's_vnum',
					allowBlank:false,
					value: s_vnum,
					xtype: 'numberfield'
				},{
					fieldLabel: '    NAZWA',
					name: 's_name',
					allowBlank:false,
					value: s_name
				},{
					xtype: 'combobox',
					fieldLabel: '    TYP',
					name: 's_type',
					store: new Ext.data.Store({
						model: 'MudExitType',
						data : [
								<%
								var first = true;
							var exitTypes = ExitTypes.getExitTypesNames();
							for(var i in exitTypes) {
								if(!first) {
									web.out.print(",");
								}
								first = false;
								web.out.println("{name: '"+exitTypes[i]+"'}");
							}
								%>
							]
					}),
					valueField: 'name',
					displayField: 'name',
					queryMode: 'local',
					emptyText: 'Wybierz typ wyjścia',
					allowBlank: false,
					value: s_type
				},{
					fieldLabel: ' ',
					name: 'w_e_p',
					allowBlank:false,
					value: ' ',
					xtype: 'displayfield'
				},{
					fieldLabel: 'Zachodnie wyjście',
					name: 'w_e',
					allowBlank:false,
					value: ' ',
					xtype: 'displayfield'
				},{
					fieldLabel: '    VNUM',
					name: 'w_vnum',
					allowBlank:false,
					value: w_vnum,
					xtype: 'numberfield'
				},{
					fieldLabel: '    NAZWA',
					name: 'w_name',
					allowBlank:false,
					value: w_name
				},{
					xtype: 'combobox',
					fieldLabel: '    TYP',
					name: 'w_type',
					store: new Ext.data.Store({
						model: 'MudExitType',
						data : [
								<%
								var first = true;
							var exitTypes = ExitTypes.getExitTypesNames();
							for(var i in exitTypes) {
								if(!first) {
									web.out.print(",");
								}
								first = false;
								web.out.println("{name: '"+exitTypes[i]+"'}");
							}
								%>
							]
					}),
					valueField: 'name',
					displayField: 'name',
					queryMode: 'local',
					emptyText: 'Wybierz typ wyjścia',
					allowBlank: false,
					value: w_type
				},{
					fieldLabel: ' ',
					name: 'e_e_p',
					allowBlank:false,
					value: ' ',
					xtype: 'displayfield'
				},{
					fieldLabel: 'Wschodnie wyjście',
					name: 'e_e',
					allowBlank:false,
					value: ' ',
					xtype: 'displayfield'
				},{
					fieldLabel: '    VNUM',
					name: 'e_vnum',
					allowBlank:false,
					value: e_vnum,
					xtype: 'numberfield'
				},{
					fieldLabel: '    NAZWA',
					name: 'e_name',
					allowBlank:false,
					value: e_name
				},{
					xtype: 'combobox',
					fieldLabel: '    TYP',
					name: 'e_type',
					store: new Ext.data.Store({
						model: 'MudExitType',
						data : [
								<%
								var first = true;
							var exitTypes = ExitTypes.getExitTypesNames();
							for(var i in exitTypes) {
								if(!first) {
									web.out.print(",");
								}
								first = false;
								web.out.println("{name: '"+exitTypes[i]+"'}");
							}
								%>
							]
					}),
					valueField: 'name',
					displayField: 'name',
					queryMode: 'local',
					emptyText: 'Wybierz typ wyjścia',
					allowBlank: false,
					value: e_type
				},{
					fieldLabel: ' ',
					name: 'u_e_p',
					allowBlank:false,
					value: ' ',
					xtype: 'displayfield'
				},{
					fieldLabel: 'Górne wyjście',
					name: 'u_e',
					allowBlank:false,
					value: ' ',
					xtype: 'displayfield'
				},{
					fieldLabel: '    VNUM',
					name: 'u_vnum',
					allowBlank:false,
					value: u_vnum,
					xtype: 'numberfield'
				},{
					fieldLabel: '    NAZWA',
					name: 'u_name',
					allowBlank:false,
					value: u_name
				},{
					xtype: 'combobox',
					fieldLabel: '    TYP',
					name: 'u_type',
					store: new Ext.data.Store({
						model: 'MudExitType',
						data : [
								<%
								var first = true;
							var exitTypes = ExitTypes.getExitTypesNames();
							for(var i in exitTypes) {
								if(!first) {
									web.out.print(",");
								}
								first = false;
								web.out.println("{name: '"+exitTypes[i]+"'}");
							}
								%>
							]
					}),
					valueField: 'name',
					displayField: 'name',
					queryMode: 'local',
					emptyText: 'Wybierz typ wyjścia',
					allowBlank: false,
					value: u_type
				},{
					fieldLabel: ' ',
					name: 'd_e_p',
					allowBlank:false,
					value: ' ',
					xtype: 'displayfield'
				},{
					fieldLabel: 'Dolne wyjście',
					name: 'd_e',
					allowBlank:false,
					value: ' ',
					xtype: 'displayfield'
				},{
					fieldLabel: '    VNUM',
					name: 'd_vnum',
					allowBlank:false,
					value: d_vnum,
					xtype: 'numberfield'
				},{
					fieldLabel: '    NAZWA',
					name: 'd_name',
					allowBlank:false,
					value: d_name
				},{
					xtype: 'combobox',
					fieldLabel: '    TYP',
					name: 'd_type',
					store: new Ext.data.Store({
						model: 'MudExitType',
						data : [
								<%
								var first = true;
							var exitTypes = ExitTypes.getExitTypesNames();
							for(var i in exitTypes) {
								if(!first) {
									web.out.print(",");
								}
								first = false;
								web.out.println("{name: '"+exitTypes[i]+"'}");
							}
								%>
							]
					}),
					valueField: 'name',
					displayField: 'name',
					queryMode: 'local',
					emptyText: 'Wybierz typ wyjścia',
					allowBlank: false,
					value: d_type
				}],

			buttons: [{
					text: 'Zapisz',
					handler: function() {
						var wurl = '/editor?page=saveroom&noHeader=true&oldvnum='+vnum
							+'&srevnum='+Ext.getCmp('roomEditForm'+erId).getForm().findField('vnum').value
							+'&srename='+Ext.getCmp('roomEditForm'+erId).getForm().findField('name').value
							+'&sresign='+Ext.getCmp('roomEditForm'+erId).getForm().findField('sign').value.replace('+', '%2B')
							+'&sretext='+Ext.getCmp('roomEditForm'+erId).getForm().findField('text').value
							+'&srearea_id='+Ext.getCmp('roomEditForm'+erId).getForm().findField('areaId').value
							+'&srearea_type='+Ext.getCmp('roomEditForm'+erId).getForm().findField('areaType').value
							+'&srenorth_exit_vnum='+Ext.getCmp('roomEditForm'+erId).getForm().findField('n_vnum').value+'&srenorth_exit_name='+Ext.getCmp('roomEditForm'+erId).getForm().findField('n_name').value+'&srenorth_exit_type='+Ext.getCmp('roomEditForm'+erId).getForm().findField('n_type').value
							+'&sresouth_exit_vnum='+Ext.getCmp('roomEditForm'+erId).getForm().findField('s_vnum').value+'&sresouth_exit_name='+Ext.getCmp('roomEditForm'+erId).getForm().findField('s_name').value+'&sresouth_exit_type='+Ext.getCmp('roomEditForm'+erId).getForm().findField('s_type').value
							+'&srewest_exit_vnum='+Ext.getCmp('roomEditForm'+erId).getForm().findField('w_vnum').value+'&srewest_exit_name='+Ext.getCmp('roomEditForm'+erId).getForm().findField('w_name').value+'&srewest_exit_type='+Ext.getCmp('roomEditForm'+erId).getForm().findField('w_type').value
							+'&sreeast_exit_vnum='+Ext.getCmp('roomEditForm'+erId).getForm().findField('e_vnum').value+'&sreeast_exit_name='+Ext.getCmp('roomEditForm'+erId).getForm().findField('e_name').value+'&sreeast_exit_type='+Ext.getCmp('roomEditForm'+erId).getForm().findField('e_type').value
							+'&srewest_exit_vnum='+Ext.getCmp('roomEditForm'+erId).getForm().findField('w_vnum').value+'&sreup_exit_name='+Ext.getCmp('roomEditForm'+erId).getForm().findField('u_name').value+'&sreup_exit_type='+Ext.getCmp('roomEditForm'+erId).getForm().findField('u_type').value
							+'&sredown_exit_vnum='+Ext.getCmp('roomEditForm'+erId).getForm().findField('d_vnum').value+'&sredown_exit_name='+Ext.getCmp('roomEditForm'+erId).getForm().findField('d_name').value+'&sredown_exit_type='+Ext.getCmp('roomEditForm'+erId).getForm().findField('d_type').value;
						if(newroom) {
							wurl += '&newroom=true'
							//a/lert('NOWY ROOM');
						}
						Ext.Ajax.request({
							url : wurl,
							method: 'GET',
							success: function ( result, request ) {
								if(result.responseText.indexOf("OKOK") >= 0) {
									Ext.getCmp("roomsGridView").store.load();
									Ext.getCmp("roomEditWindow"+erId).hide();
								}
								else Ext.MessageBox.alert('Failed', "Błąd: "+result.responseText+"!");
							},
							failure: function ( result, request) {
								Ext.MessageBox.alert('Failed', "Nie udało się zapisać tego rooomu!");
							}
						});
					}
				},{
					text: 'Anuluj',
					handler: function() {
						Ext.getCmp("roomEditWindow"+erId).hide();
					}
				}]
		});


		Ext.create('widget.window', {
			id: 'roomEditWindow'+erId,
			title: 'Edytuj room '+name+' #'+vnum,
			bodyStyle:'padding:5px',
			closable: true,
			width: 600,
			height: 350,
			plain: true,
			layout: 'fit',
			items: [Ext.getCmp('roomEditForm'+erId)]
		});

		Ext.getCmp("roomEditWindow"+erId).show(this);
	}

	function deleteRoom(vnum, rowIndex) {
		Ext.MessageBox.confirm('Confirm', 'Czy na pewno chcesz usunąć ten room ('+vnum+')', function(btn) {
			if(btn == 'yes') {
				Ext.Ajax.request({
					url : '/editor?page=deleteroom&noHeader=true&vnum='+vnum ,
					method: 'GET',
					success: function ( result, request ) {
						if(result.responseText.indexOf("OKOK") >= 0) Ext.getCmp("roomsGridView").store.load();
						else Ext.MessageBox.alert('Failed', "Nie udało się usunąć tego roomu: "+result.responseText+"!");
					},
					failure: function ( result, request) {
						Ext.MessageBox.alert('Failed', "Nie udało się usunąć tego roomu!");
					}
				});
			}
		});
	}






	function reloadUsersGrid() {
		Ext.getCmp("usersGridView").store.load();
		setTimeout("reloadUsersGrid()", 30000);
	}
</script>